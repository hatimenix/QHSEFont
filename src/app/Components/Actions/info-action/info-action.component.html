<div class="content-page">
    <div class="container-fluid">
       <div class="row">
          <div class="col-sm-12">
            
             <div class="card">
                <div class="card-header d-flex justify-content-between">
                   <div class="header-title">
                      <h4 class="card-title">Registre des actions</h4>
                   </div>
                </div>
                <div class="card-body">
                   <div class="iq-example-row">
                      <div class="container-fluid">
                         <ul class="nav nav-pills mb-3 nav-fill" id="pills-tab-1" role="tablist">
                            <li class="nav-item col-6 col-md-4">
                               <a class="nav-link active" id="pills-home-tab-fill" data-toggle="pill" href="#description" role="tab" aria-controls="pills-home" aria-selected="true">DESCRIPTION</a>
                            </li>
                            <li class="nav-item col-6 col-md-4">
                               <a class="nav-link" id="pills-profile-tab-fill" data-toggle="pill" href="#realisation" role="tab" aria-controls="pills-profile" aria-selected="false">REALISATION</a>
                            </li>
                            <li class="nav-item col-6 col-md-4">
                               <a class="nav-link" id="pills-contact-tab-fill" data-toggle="pill" href="#mesure_efficacite" role="tab" aria-controls="pills-contact" aria-selected="false">MESURE D'EFFICACITE</a>
                            </li>
                         </ul>
                         <div class="tab-content" id="pills-tabContent-1">
                            <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="pills-home-tab-fill">
                                <div class="card-body">
                                    <div id="table" class="table-editable">
                                       <span class="table-add float-left mb-3 mr-2">
                                       <h5>Description de l'action</h5>
                                       </span>
                                       <table class="table table-bordered table-responsive-md table-striped text-center">
                                          <tbody>
                                             <tr>
                                                <td style="width:50%">Intitulé action</td>
                                                <td style="width:50%">{{ action.intitule }}</td>
                                             </tr>
                                             <tr>
                                                <td style="width:50%">Type d'action</td>
                                                <td style="width:50%">{{ action.type_action }}</td>
                                             </tr>
                                             <tr>
                                                <td style="width:50%">Origine de l'action</td>
                                                <td style="width:50%">{{ action.origine_action }}</td>
                                             </tr>
                                             <tr>
                                                <td style="width:50%">Référence action</td>
                                                <td style="width:50%">{{ action.reference }}</td>
                                             </tr>
                                             <tr>
                                                <td style="width:50%">Domaine</td>
                                                <td style="width:50%">{{ action.domaine }}</td>
                                             </tr>
                                             <tr>
                                                <td style="width:50%">Site</td>
                                                <td style="width:50%">{{ this.siteName }}</td>
                                             </tr>
                                             <tr>
                                                <td style="width:50%">Processus concerné par l'action</td>
                                                <td style="width:50%">{{ this.procesName }}</td>
                                             </tr>
                                             <tr>
                                                <td style="width:50%">Analyse causes(AC) / risques (AP)</td>
                                                <td style="width:50%">{{ action.analyse_cause }}</td>
                                             </tr>
                                             <tr>
                                                <td style="width:50%">Plan d'actions</td>
                                                <td style="width:50%">{{ action.plan_action }}</td>
                                             </tr>
                                          </tbody>
                                       </table>
                                    </div>
                                    <div id="table" class="table-editable">
                                        <span class="table-add float-left mb-3 mr-2">
                                        <h5>Prise en charge de l'action</h5>
                                        </span>
                                        <table class="table table-bordered table-responsive-md table-striped text-center">
                                           <tbody>
                                              <tr>
                                                 <td style="width:50%">Délai mise en oeuvre</td>
                                                 <td style="width:50%">{{ action.delai_mise_en_oeuvre }}</td>
                                              </tr>
                                              <tr>
                                                 <td style="width:50%">Assigné à</td>
                                                 <td style="width:50%">{{ action.assigne_a }}</td>
                                              </tr>
                                              <tr>
                                                 <td style="width:50%">Priorité</td>
                                                 <td style="width:50%">{{ action.priorite }}</td>
                                              </tr>
                                           </tbody>
                                        </table>
                                     </div>
                                     <div id="table" class="table-editable">
                                        <span class="table-add float-left mb-3 mr-2">
                                        <h5>Prise en charge de la mesure d'efficacité</h5>
                                        </span>
                                        <table class="table table-bordered table-responsive-md table-striped text-center">
                                           <tbody>
                                              <tr>
                                                 <td style="width:50%">SDélai mesure efficacité</td>
                                                 <td style="width:50%">{{ action.delai_mesure_eff }}</td>
                                              </tr>
                                              <tr>
                                                 <td style="width:50%">Type de critère d'efficacité</td>
                                                 <td style="width:50%">{{ action.type_critere_eff }}</td>
                                              </tr>
                                              <tr>
                                                 <td style="width:50%">Détail sur le critère d'efficacité</td>
                                                 <td style="width:50%">{{ action.detail_critere_eff }}</td>
                                              </tr>
                                              <tr>
                                                <td style="width:50%">Pièce(s) jointe(s)</td>
                                                <td style="width:50%">{{ action.piece_jointe }}</td>
                                             </tr>
                                           </tbody>
                                        </table>
                                     </div>
                                 </div>
                            </div>
                            <div class="tab-pane fade" id="realisation" role="tabpanel" aria-labelledby="pills-profile-tab-fill">
                              <div id="table" class="table-editable">
                                 <table class="table table-bordered table-responsive-md table-striped text-center">
                                    <tr *ngIf="( realisation$ | async)?.length === 0">
                                       <td>Réalisation</td>
                                       <td colspan="5">Aucune réalisation enregistré pour cette action</td>
                                     </tr>
                                    <tbody *ngFor="let realisation of realisation$ | async">
                                       <tr>
                                          <td style="width:50%">Origine</td>
                                          <td style="width:50%">{{ action.origine_action }}</td>
                                       </tr>
                                       <tr>
                                          <td style="width:50%">Tache(s) associées(s)</td>
                                          <td style="width:50%"></td>
                                       </tr>
                                       <tr>
                                          <td style="width:50%">Action réalisée</td>
                                          <td style="width:50%">{{ realisation.action_realisee }}</td>
                                       </tr>
                                       <tr>
                                          <td style="width:50%">Date de réalisations</td>
                                          <td style="width:50%">{{ realisation.date_realisation }}</td>
                                       </tr>
                                       <tr>
                                          <td style="width:50%">Etat</td>
                                          <td style="width:50%">{{ realisation.etat }}</td>
                                       </tr>
                                    </tbody>
                                 </table>
                              </div>
                            </div>
                            <div class="tab-pane fade" id="mesure_efficacite" role="tabpanel" aria-labelledby="pills-contact-tab-fill">
                              <div id="table" class="table-editable table-responsive">
                                <table class="table table-bordered table-responsive-md table-striped text-center">
                                    <tr *ngIf="( mesure$ | async)?.length === 0">
                                       <td>Mesure d'éfficacité</td>
                                       <td colspan="4">Aucune mesure n'est enregistré pour cette action <a  class="badge bg-warning mr-2" data-toggle="modal" data-target="#exampleModalCenteredScrollable" data-placement="top"><i class="ri-add-line"></i>Nouvelle entrée</a></td>
                                     </tr>
                                    <tbody *ngFor="let mesure of mesure$ | async">
                                       <tr>
                                          <td style="width:50%">Date cloture</td>
                                          <td style="width:50%">{{ mesure.date_cloture }}</td>
                                       </tr>
                                       <tr>
                                          <td style="width:50%">Résultat mesure efficacité</td>
                                          <td style="width:50%">{{ mesure.resultat_mesure_eff }}</td>
                                       </tr>
                                       <tr>
                                          <td style="width:50%">Mesure de l'efficacité</td>
                                          <td style="width:50%">{{ mesure.mesure_eff }}</td>
                                       </tr>
                                       <tr>
                                          <td style="width:50%">Cout</td>
                                          <td style="width:50%">{{ mesure.cout }}</td>
                                       </tr>
                                    </tbody>
                                 </table>
                                 <div class="d-flex align-items-end flex-column" style="height: 80px;" *ngFor="let mesure of mesure$ | async">
                                    <div class="mt-auto p-2"><a class="btn btn-primary add-list"><i class="ri-pencil-line mr-0"></i>Modifier</a>
                                       <a class="btn btn-primary add-list mx-2" data-toggle="modal" data-target="#delete_mesure" (click)="openDeleteModal(mesure.id)"><i class="ri-delete-bin-line mr-0"></i>Supprimer</a></div>
                                  </div>
                                  <div class="modal fade" id="delete_mesure" tabindex="-1" role="dialog" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                <div class="popup text-left">
                                                    <h4 class="mb-3">Confirmer la suppression</h4>
                                                    <div class="content create-workform bg-body">
                                                        <div class="pb-3">
                                                            <label class="mb-2">Est ce que vous voulez supprimer cette mesure définitivement !!</label>
                                                        </div>
                                                        <div class="col-lg-12 mt-4">
                                                            <div class="d-flex flex-wrap align-items-ceter justify-content-center">
                                                                <div class="btn btn-primary mr-4" data-dismiss="modal" (click)="deleteMesure()">Supprimer</div>
                                                                <div class="btn btn-outline-primary" data-dismiss="modal">Annuler</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>                                  
                                 <div id="exampleModalCenteredScrollable" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenteredScrollableTitle" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
                                       <div class="modal-content">
                                          <div class="modal-header">
                                             <h5 class="modal-title" id="exampleModalCenteredScrollableTitle">Ajout Mesure efficacité</h5>
                                             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                             <span aria-hidden="true">×</span>
                                             </button>
                                          </div>
                                          <div class="modal-body">
                                             <form [formGroup]="mesureForm" (ngSubmit)="onSubmit()"  class="needs-validation" novalidate>                                            
                                                <div class="form-group">
                                                   <label for="delai_mesure_eff">Date cloture :</label>
                                                   <input type="date" class="form-control" formControlName="date_cloture" required/>
                                                 </div>
                                                <div class="form-group">
                                                  <label for="delai_mise_en_oeuvre">Résultat mesure efficacité :</label>
                                                  <div class="custom-control custom-radio custom-control-inline ml-2">
                                                   <input type="radio" id="customRadio6" name="resultat_mesure_eff" class="custom-control-input" value="Efficace" formControlName="resultat_mesure_eff" required>
                                                   <label class="custom-control-label" for="customRadio6"> Efficace </label>
                                                </div>
                                                <div class="custom-control custom-radio custom-control-inline">
                                                   <input type="radio" id="customRadio7" name="resultat_mesure_eff" class="custom-control-input" value="Non efficace" formControlName="resultat_mesure_eff" required>
                                                   <label class="custom-control-label" for="customRadio7"> Non efficace </label>
                                                </div>
                                                </div>
                                                <div class="form-group">
                                                  <label for="assigne_a">Mesure de l'efficacité :</label>
                                                  <textarea class="form-control" formControlName="mesure_eff" required></textarea>
                                                </div>
                                                <div class="form-group">
                                                   <label for="type_critere_eff">Cout :</label>
                                                   <input type="number" class="form-control" formControlName="cout" min="0" required/>
                                                 </div>
                                                <div class="d-flex align-items-end flex-column" >
                                                   <button type="submit" class="btn btn-primary" [disabled]="mesureForm.invalid">Ajouter</button>
                                                </div>                                   
                                              </form>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                               </div>                               
                            </div>
                         </div>
                      </div>
                   </div>
                </div>
             </div>
       </div>
    </div>
    </div>
    